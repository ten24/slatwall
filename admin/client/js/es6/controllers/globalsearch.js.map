{"version":3,"sources":["controllers/globalsearch.ts"],"names":[],"mappings":"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","file":"controllers/globalsearch.js","sourceRoot":"/Users/david/Sites/Slatwall/","sourcesContent":["'use strict';\nangular.module('slatwalladmin').controller('globalSearch', [\n\t'$scope',\n\t'$log',\n\t'$window',\n\t'$timeout',\n\t'$slatwall',\n\tfunction(\n\t\t$scope,\n\t\t$log,\n\t\t$window,\n\t\t$timeout,\n\t\t$slatwall\n\t){\n\t\t$scope.keywords = '';\n\t\t$scope.searchResultsOpen = false;\n\t\t$scope.sidebarClass = 'sidebar';\n\t\t$scope.loading = false; //Set loading wheel to false\n\t\t$scope.resultsFound = true; // Set the results Found to true because no search has been done yet\n\t\n\t\t$scope.searchResults = {\n\t\t\t'product' : {\n\t\t\t\t'title': 'Products',\n\t\t\t\t'resultNameFilter': function(data) {\n\t\t\t\t\treturn data['productName'];\n\t\t\t\t},\n\t\t\t\t'results' : [],\n\t\t\t\t'id' : function(data) {\n\t\t\t\t\treturn data['productID'];\n\t\t\t\t}\n\t\t\t},\n\t\t\t'brand' : {\n\t\t\t\t'title': $slatwall.getRBKey('entity.Brands'),\n\t\t\t\t'resultNameFilter': function(data) {\n\t\t\t\t\treturn data['brandName'];\n\t\t\t\t},\n\t\t\t\t'results' : [],\n\t\t\t\t'id' : function(data) {\n\t\t\t\t\treturn data['brandID'];\n\t\t\t\t}\n\t\t\t},\n\t\t\t'account' : {\n\t\t\t\t'title': 'Accounts',\n\t\t\t\t'resultNameFilter': function(data) {\n\t\t\t\t\treturn data['firstName'] + ' ' + data['lastName'];\n\t\t\t\t},\n\t\t\t\t'results' : [],\n\t\t\t\t'id' : function(data) {\n\t\t\t\t\treturn data['accountID'];\n\t\t\t\t}\n\t\t\t},\n\t\t\t'vendor' : {\n\t\t\t\t'title': 'Vendors',\n\t\t\t\t'resultNameFilter': function(data) {\n\t\t\t\t\treturn data['vendorName'];\n\t\t\t\t},\n\t\t\t\t'results' : [],\n\t\t\t\t'id' : function(data) {\n\t\t\t\t\treturn data['vendorID'];\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\n\t\n\t\tvar _timeoutPromise;\n\t\tvar _loadingCount = 0;\n\t\t\n\t\t$scope.updateSearchResults = function() {\n\t\t\t\n\t\t\t$scope.loading = true;\n\t\t\t$scope.showResults();\n\t\t\t\n\t\t\tif(_timeoutPromise) {\n\t\t\t\t$timeout.cancel(_timeoutPromise);\n\t\t\t}\n\t\n\t\t\t_timeoutPromise = $timeout(function(){\n\t\t\t\t\n\t\t\t\t// If no keywords, then set everything back to their defaults\n\t\t\t\tif($scope.keywords === ''){\n\t\t\t\t\t$scope.hideResults();\n\t\t\t\t\t\n\t\t\t\t// Otherwise performe the search\n\t\t\t\t} else {\n\t\t\t\t\t$scope.showResults();\n\t\t\t\t\n\t\t\t\t\t// Set the loadingCount to the number of AJAX Calls we are about to do\n\t\t\t\t\t_loadingCount = Object.keys($scope.searchResults).length;\n\t\t\t\t\t\n\t\t\t\t\tfor (var entityName in $scope.searchResults){\n\t\t\t\t\t\t\n\t\t\t\t\t\t(function(entityName) {\n\t\t\n\t\t\t\t\t\t\tvar searchPromise = $slatwall.getEntity(entityName, {keywords : $scope.keywords, pageShow : 4, deferkey : 'global-search-'+entityName} );\n\t\t\n\t\t\t\t\t\t\tsearchPromise.then(function(data){\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// Clear out the old Results\n\t\t\t\t\t\t\t\t$scope.searchResults[ entityName ].results = [];\n\t\t\t\t\t\t\t\t$scope.searchResults[ entityName ].title = $slatwall.getRBKey('entity.'+entityName.toLowerCase()+'_plural');\n\t\t\t\t\t\t\t\t// push in the new results\n\t\t\t\t\t\t\t\tfor(var i in data.pageRecords) {\n\t\t\t\t\t\t\t\t\t$scope.searchResults[ entityName ].results.push({\n\t\t\t\t\t\t\t\t\t\t'name': $scope.searchResults[ entityName ].resultNameFilter( data.pageRecords[i] ),\n\t\t\t\t\t\t\t\t\t\t'link': '?slatAction=entity.detail'+entityName+'&'+entityName+'ID='+$scope.searchResults[ entityName ].id(data.pageRecords[i]),\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// Increment Down The Loading Count\n\t\t\t\t\t\t\t\t_loadingCount--;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// If the loadingCount drops to 0, then we can update scope\n\t\t\t\t\t\t\t\tif(_loadingCount == 0){\n\t\t\t\t\t\t\t\t\t$scope.loading = false;\t\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tvar _foundResults = false;\n\t\t\t\t\t\t\t\t\tfor (var _thisEntityName in $scope.searchResults){\n\t\t\t\t\t\t\t\t\t\tif($scope.searchResults[ _thisEntityName ].results.length){\n\t\t\t\t\t\t\t\t\t\t\t_foundResults = true;\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t$scope.resultsFound = _foundResults;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t});\n\t\t\n\t\t\t\t\t\t})( entityName );\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t}\n\t\n\t\t\t}, 500);\n\t\t\n\t\t\t\n\t\t};\n\t\n\t\n\t\t$scope.showResults = function() {\n\t\t\t$scope.searchResultsOpen = true;\n\t\t\t$scope.sidebarClass = 'sidebar s-search-width';\n\t\t\t$window.onclick = function(event){\n\t\t\t\tvar _targetClassOfSearch = event.target.parentElement.offsetParent.classList.contains('sidebar');\n\t\t\t\tif(!_targetClassOfSearch){\n\t\t\t\t\t$scope.hideResults();\n\t\t\t\t\t$scope.$apply();\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\t\n\t\t$scope.hideResults = function() {\n\t\t\t$scope.searchResultsOpen = false;\n\t\t\t$scope.sidebarClass = 'sidebar';\n\t\t\t$scope.search.$setPristine();\n\t\t\t$scope.keywords = \"\";\n\t\t\t$window.onclick = null;\n\t\t\t$scope.loading = false;\n\t\t\t$scope.resultsFound = true;\n\t\t\t\n\t\t\tfor (var entityName in $scope.searchResults){\n\t\t\t\t$scope.searchResults[ entityName ].results = [];\n\t\t\t}\n\t\t};\n\n\t}\n]);\n"]}