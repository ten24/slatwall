<div class="checkout-bar">
	<div class="p-md-4 mb-5 pb-1">
		<section class="accordion" id="checkoutAccordion">
			<!--- Shipping Address Options --->
			<div class="border-bottom">
				<flexship-checkout-shipping-address id="shipping_sec"></flexship-checkout-shipping-address>
			</div>
			
			<!--- Shipping Method --->
			<div class="border-bottom">
				<flexship-checkout-shipping-method id="shipping_method_sec"></flexship-checkout-shipping-method>
			</div>
			
			<!--- Payment --->
			<div>
				<div class="my-3 py-2 row w-75-scale mx-auto">
					<div class="col-9 col-md-8">
						<h2 class="h2-md-scale d-inline-block">
							<i class="pr-4 fal fa-credit-card"></i>
							<a ng-click="checkout.state.currentStep = checkout.SCREEN.PAYMENT" data-toggle="collapse" href="##payment" role="button" aria-expanded="false" aria-controls="payment" sw-rbkey="'frontend.paymentMethodModal.paymentMethod'">
							</a>
						</h2>
						<span class="secured" sw-rbkey="'frontend.checkout.secureCheckout'"></span>
						<p class="sub-paragraph" ng-show="checkout.currentPaymentMethodID.length && checkout.state.payment.showParagraph && checkout.state.maximumStep >= checkout.SCREEN.PAYMENT">
							<span ng-repeat="paymentMethod in slatwall.account.accountPaymentMethods | filter:{ accountPaymentMethodID:checkout.currentPaymentMethodID, activeFlag: true }">
								{{paymentMethod.creditCardType}} {{paymentMethod.creditCardLastFour}} 
							</span>							
						</p>
					</div>
					<div class="col-3 col-md-4">
						<a ng-click="checkout.state.currentStep = checkout.SCREEN.PAYMENT" class="float-right edit-link" data-toggle="collapse" href="##payment" role="button" aria-expanded="false" aria-controls="payment">
							<span class="d-none d-md-inline" sw-rbkey="'frontend.global.edit'"></span><i class="pl-3 fal fa-pen"></i>
						</a>	
					</div>
				</div>
	            <!--- Payment tab. --->
	            <div 
	            	data-parent="##checkoutAccordion"
	            	class="collapse ml-md-4"
	            	id="payment" 
	            	ng-class="{
		            	'show': checkout.state.currentStep === checkout.SCREEN.PAYMENT
		            }"
	            	ng-show="
	            		checkout.state.currentStep === checkout.SCREEN.PAYMENT
	            	"
	            	 se-loading="flexshipCheckout.loading"
	            >
	            	<section class="shipping-page payment-page">
	            		<div class="w-75-scale mx-auto">
			            	<div class="payment_sec pb-5 px-3 px-md-4">

				            	<div class="payment-options-form pt-0" >
									<div class="radio_sec">
										<div class="custom-radio mb-2">
											<input 
											    type="radio" name="selectedPaymentProvider" id="payment_cc" 
											    ng-checked="flexshipCheckout.currentState.selectedPaymentProvider === 'creditCard' " 
											/>
											<label for="payment_cc" 
												sw-rbkey="'frontend.checkout.payCC'"
												ng-click="flexshipCheckout.setSelectedPaymentProvider('creditCard')"
											></label>
										</div>
									</div>
									<div class="radio_sec">
										<div class="custom-radio mb-2">
											<input 
			    								type="radio" name="selectedPaymentProvider" id="payment_payPal"
			    								ng-checked="flexshipCheckout.currentState.selectedPaymentProvider === 'payPal' " 
											/>
											<label for="payment_payPal" 
												sw-rbkey="'frontend.checkout.payPaypal'"
												ng-click="flexshipCheckout.setSelectedPaymentProvider('payPal')"
											></label>
										</div>
									</div>
								</div>

								<!--paymant-method-paypal-->
								<div ng-if="flexshipCheckout.currentState.selectedPaymentProvider === 'payPal'" class="mb-5 pb-5">
									<p class="checkout-subheading" sw-rbkey="'frontend.checkout.newPaymentMethodPaypal'"></p>
									<div id="paypal-button" ng-init="flexshipCheckout.configurePayPal()"></div>
								</div>

								<!--TODO: refactor new-payment-method-form into it's own componant-->
					
								<!--paymant-method-CC-->
								<div ng-if="flexshipCheckout.currentState.selectedPaymentProvider === 'creditCard'" class="mb-5 pb-5">
									
									<div ng-if="!flexshipCheckout.currentState.showNewPaymentMethodForm">
										<p class="checkout-subheading" sw-rbkey="'frontend.checkout.savedCC'"></p>

										<!--saved CC-->
										<div 
											class="custom-radio mb-2"
											ng-repeat="paymentMethod in flexshipCheckout.currentState.accountPaymentMethods "
											ng-if="paymentMethod.creditCardLastFour.length" 
											ng-click="flexshipCheckout.setSelectedPaymentMethodID( paymentMethod.accountPaymentMethodID)" 
										>
											<input 
												type="radio" 
												name="accountPaymentMethod"
												id="paymentMethod-{{paymentMethod.accountPaymentMethodID}}"
												ng-checked="flexshipCheckout.currentState.selectedPaymentMethodID === paymentMethod.accountPaymentMethodID"
											>
											<label for="paymentMethod-{{paymentMethod.accountPaymentMethodID}}">
												<i  class="fab fa-2x align-middle mr-2"
													ng-class="{
														'fa-cc-visa': paymentMethod.creditCardType == 'Visa',
														'fa-cc-mastercard': paymentMethod.creditCardType == 'Mastercard',
														'fa-paypal': paymentMethod.creditCardType == 'PayPal'
													}"
												></i> 
												{{paymentMethod.creditCardType}} {{paymentMethod.creditCardLastFour}} 
												<span class="ml-3 tag-default" 
													ng-if="flexshipCheckout.currentState.primaryPaymentMethodID == paymentMethod.accountPaymentMethodID" 
													sw-rbKey="'frontend.global.default'"
												></span>
											</label>
										</div>
										
										<!--new CC-->
										<div class="custom-radio" ng-click="flexshipCheckout.setSelectedPaymentMethodID('new')" >
											<input 
												id="newCard"
												type="radio" 
												name="accountPaymentMethod"
												ng-checked="flexshipCheckout.currentState.showNewPaymentMethodForm"
											>
											<label for="newCard" sw-rbkey="'frontend.paymentmethodmodal.addnewcreditcard'"> </label>
										</div>
									</div>
									
									
									<!---============== New Payment Method Section============== --->
									<div ng-if="flexshipCheckout.currentState.showNewPaymentMethodForm">
										
										<!---======== Billing Address Options ========--->
										
										<div ng-if="!flexshipCheckout.currentState.showNewBillingAddressForm">
											
											<p class="checkout-subheading" sw-rbKey="'frontend.checkout.billingAddress'"></p>
					
											<!--- Billing Same As ShippingAddress CheckBox --->
											<div class="custom-radio checkbox mb-2" >
												<input class="form-check-input" type="checkbox" id="billingsameasshipping"
													ng-checked="flexshipCheckout.currentState.billingSameAsShipping"
													ng-click="flexshipCheckout.toggleBillingSameAsShipping()"
												>
												<label class="form-check-label" for="billingsameasshipping" 
													sw-rbkey="'frontend.checkout.billingAddressSame'"
												></label>
										    </div>
										    
										    <!--- Create New Billing Address--->
											<div class="custom-radio checkbox" >
												<input class="form-check-input" type="checkbox" id="new-billing-address-button"
													ng-checked="!flexshipCheckout.currentState.billingSameAsShipping"
													ng-click="flexshipCheckout.setSelectedBillingAddressID('new')" 
												>
												<label class="form-check-label" for="new-billing-address-button" 
													sw-rbkey="'frontend.checkout.addBillingAddress'"
												></label>
										    </div>
											
											<!--- Billing Address Dropdown Select --->
											<div>
												<div class="material-field">
													<select 
														class="form-control mt-3 mb-3" 
														name="billingAddress" 
														ng-disabled="flexshipCheckout.currentState.billingSameAsShipping"
														ng-model="flexshipCheckout.currentState.selectedBillingAddressID" 
														ng-change="flexshipCheckout.setSelectedBillingAddressID(flexshipCheckout.currentState.selectedBillingAddressID)"
														ng-options="accountAddress.accountAddressID as flexshipCheckout.formatAddress(accountAddress) for accountAddress in flexshipCheckout.currentState.accountAddresses"
													>
														<option value="" sw-rbKey="'frontend.checkout.selectAccountAddress'" disabled></option>
													</select>
												</div>
											</div>
										</div>
									  	<!---============== New Billing Address Section============== --->
										<div id="new-billing-account-address-form"></div>
										<!---============== END: New Billing Address Section============== --->
										<div ng-if="flexshipCheckout.currentState.showNewBillingAddressForm" class="w-100 my-5"><hr/></div>
					
										<!---========END: Billing Address Options ========--->
										
										<!---============== New CC Section============== --->
										<form name="newPaymentMethodForm"
											ng-if="flexshipCheckout.currentState.showNewPaymentMethodForm"
											ng-submit="newPaymentMethodForm.$valid && flexshipCheckout.addNewPaymentMethod()"
											class="border-top pt-4 mt-4"
										>
											<p class="checkout-subheading" sw-rbKey="'frontend.checkout.newPaymentMethodCard'"></p>
											<div class="row cc-block">
												<!--name on card-->
												<div class="col-12">
													<div class="material-field">
														<input type="text" class="form-control"
															name = "newCreditCard_nameOnCard"
															swvalidationrequired = "true"
															ng-model="flexshipCheckout.newAccountPaymentMethod.nameOnCreditCard"
														/>
														<label class="form-label" sw-rbkey="'frontend.newCreditCard.nameOnCard'"></label>
														<div ng-if="newPaymentMethodForm.$submitted" ng-messages="newPaymentMethodForm.newCreditCard_nameOnCard.$error">
							    						    <div ng-messages-include="monat-form-generic-validation-error-messages"></div>
							    						</div>
													</div>
												</div>

												<!--card number-->
												<div class="col-12">
													<div class="material-field">
														<input type="text" class="form-control"
															name = "newAccountPaymentMethod_creditCardNumber"
															swvalidationrequired = "true" swvalidationnumeric="true"
															ng-model="flexshipCheckout.newAccountPaymentMethod.creditCardNumber"
														/>
														<label class="form-label" sw-rbkey="'frontend.newCreditCard.creditCardNumber'"></label>
														<div ng-if="newPaymentMethodForm.$submitted" ng-messages="newPaymentMethodForm.newAccountPaymentMethod_creditCardNumber.$error">
							    						    <div ng-messages-include="monat-form-generic-validation-error-messages"></div>
							    						</div>
													</div>
												</div>
												
												<div class="col-8 expDate pl-3 mt-3">
													<div class="col-12 row pr-0">
														<span class="label" sw-rbkey="'frontend.newCreditCard.expDate'"></span>
														<div class="sub col px-0">
															<div class="material-field">
																<select type="text" class="form-control"
																	name = "newCreditCard_expirationMonth"
																	swvalidationrequired = "true"
																	ng-model="flexshipCheckout.newAccountPaymentMethod.expirationMonth"
																	ng-options="month for month in flexshipCheckout.expirationMonthOptions"
																>
																</select>
																<label for="expirationMonth">MM</label>
																<div ng-if="newPaymentMethodForm.$submitted" ng-messages="newPaymentMethodForm.newCreditCard_expirationMonth.$error">
									    						    <div ng-messages-include="monat-form-generic-validation-error-messages"></div>
									    						</div>
															</div>
														</div>
														<div class="sub col-1 pt-4">/</div>
														<div class="sub col px-0">
															<div class="material-field">
																<select type="text" class="form-control"
																	name = "newCreditCard_expirationYear"
																	swvalidationrequired = "true"
																	ng-model="flexshipCheckout.newAccountPaymentMethod.expirationYear"
																	ng-options="year.VALUE as year.NAME for year in flexshipCheckout.expirationYearOptions"
																>
																</select>
																<label for="expirationMonth">YYYY</label>
																<div ng-if="newPaymentMethodForm.$submitted" ng-messages="newPaymentMethodForm.newCreditCard_expirationYear.$error">
									    						    <div ng-messages-include="monat-form-generic-validation-error-messages"></div>
									    						</div>
															</div>
														</div>
													</div>
												</div>
												
							
												<!--cvv-->
												<div class="col-4 mt-3">
													<div class="material-field">
														<input type="number" class="form-control"
															name = "newCreditCard_securityCode"
															swvalidationrequired = "true"
															swvalidationnumeric="true" swvalidationmaxlength = "4" swvalidationminlength = "3"
															ng-model="flexshipCheckout.newAccountPaymentMethod.securityCode"
														/>
														<label class="form-label" sw-rbkey="'frontend.newCreditCard.securityCode'"></label>
														<div ng-if="newPaymentMethodForm.$submitted" ng-messages="newPaymentMethodForm.newCreditCard_securityCode.$error">
															 <div ng-message="swvalidationmaxlength" sw-Rbkey="'validation.define.maxlength4'" class="text-danger error_text"></div>
															 <div ng-message="swvalidationminlength" sw-Rbkey="'validation.define.minlength3'" class="text-danger error_text"></div>
							    						     <div ng-messages-include="monat-form-generic-validation-error-messages"></div>
							    						</div>
													</div>
												</div>
											</div>
											<button  type="submit" class="btn bg-primary" 
												ng-class="{ loading: flexshipCheckout.newAccountPaymentMethod.loading }"
												ng-disabled = "flexshipCheckout.newAccountPaymentMethod.loading"
											>
												<i class="fa fa-plus-circle"></i> 
												<span sw-rbKey="'frontend.checkout.addPayment'"></span>
											</button>
											<button type="button" class="btn bg-secondary"
												ng-click="flexshipCheckout.closeAddNewPaymentForm()"
												ng-class="{ disabled : flexshipCheckout.newAccountPaymentMethod.loading}"
												ng-disabled = "flexshipCheckout.newAccountPaymentMethod.loading"
												sw-rbkey="'frontend.global.cancel'"
											></button>
										</form>
										<!---==============END New CC Section============== --->
									</div>
									<!---==============END: New Payment Method Section============== --->
								</div>
							</div>
						</div>
					</section>
        	
	            </div><!--- end #payment --->

			</div>
		</section>
	</div>
</div>
