{"version":3,"sources":["controllers/preprocessaccount_addaccountpayment.ts"],"names":[],"mappings":"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","file":"controllers/preprocessaccount_addaccountpayment.js","sourceRoot":"/Users/david/Sites/Slatwall/","sourcesContent":["'use strict';\nangular.module('slatwalladmin')\n.controller('preprocessaccount_addaccountpayment', ['$scope','$compile',function($scope, $compile) {\n\t//Define the different payment types used here\n\tvar paymentType = {aptCharge:\"444df32dd2b0583d59a19f1b77869025\",aptCredit:\"444df32e9b448ea196c18c66e1454c46\", aptAdjustment:\"68e3fb57d8102b47acc0003906d16ddd\"};\n\t\n\t$scope.totalAmountToApply = 0; //Default value to show on new form\n\t$scope.paymentTypeName = $.slatwall.rbKey('define.charge'); //Default payment type\n\t$scope.paymentTypeLock = true; //Used to lock down the order payment type dropdowns\n\t$scope.amount = 0;\n\t\n\t$scope.updatePaymentType = function() {\n\t\t//Change all order payment types here\n\t\tangular.forEach($scope.appliedOrderPayment, function(obj, key) {\n\t\t\t//Only change the payment type if the type isn't adjustment'\n\t\t\tif($scope.paymentType!=paymentType.aptAdjustment)\n\t\t\t\tobj.paymentType=$scope.paymentType;\n\t\t});\n\t\t\n\t\tif($scope.paymentType==paymentType.aptCharge) {\n\t\t\t$scope.paymentTypeName = $.slatwall.rbKey('define.charge');\n\t\t\t$scope.paymentTypeLock = true;\n\t\t} else if($scope.paymentType==paymentType.aptCredit) {\n\t\t\t$scope.paymentTypeName = $.slatwall.rbKey('define.credit');\n\t\t\t$scope.paymentTypeLock = true;\n\t\t} else if($scope.paymentType==paymentType.aptAdjustment) {\n\t\t\t$scope.paymentTypeLock = false;\n\t\t\t$scope.paymentTypeName = $.slatwall.rbKey('define.adjustment');\n\t\t\t$scope.amount = 0;\n\t\t}\n\t\t\n\t\t//Update the subtotal now that we changed the payment type\n\t\t$scope.updateSubTotal();\n\t};\n\n\t$scope.updateSubTotal = function() {\n\t\t$scope.totalAmountToApply = 0; //Reset the subtotal before we loop\n\t\t\n\t\t//Loop through all the amount fields and create a running subtotal\n\t\tangular.forEach($scope.appliedOrderPayment, function(obj, key) {\n\t\t\t//Don't count the field if its undefied or not a number\n\t\t\tif(obj.amount != undefined && !isNaN(obj.amount)) {\n\t\t\t\t//Charge / adjustment condition for subtotal\n\t\t\t\tif($scope.paymentType==paymentType.aptCharge || $scope.paymentType == paymentType.aptAdjustment) {\n\t\t\t\t\tif(obj.paymentType==paymentType.aptCharge)\n\t\t\t\t\t\t$scope.totalAmountToApply += parseFloat(obj.amount);\n\t\t\t\t\telse if(obj.paymentType==paymentType.aptCredit)\n\t\t\t\t\t\t$scope.totalAmountToApply -= parseFloat(obj.amount);\n\n\t\t\t\t//Credit condition for subtotal\n\t\t\t\t} else if($scope.paymentType==paymentType.aptCredit) {\n\t\t\t\t\tif(obj.paymentType==paymentType.aptCharge)\n\t\t\t\t\t\t$scope.totalAmountToApply -= parseFloat(obj.amount);\n\t\t\t\t\telse if(obj.paymentType==paymentType.aptCredit)\n\t\t\t\t\t\t$scope.totalAmountToApply += parseFloat(obj.amount);\n\t\t\t\t}\n\t\t\t}\n\t    });\n\n\t\t//The amount not applied to an order\n\t    $scope.amountUnapplied = (Math.round(($scope.amount - $scope.totalAmountToApply) * 100) / 100);\n\t\t$scope.accountBalanceChange = parseFloat($scope.amount);\n\t\t\n\t\t//Switch the account balance display amount to a negative if you are doing a charge\n\t\tif($scope.paymentType==paymentType.aptCharge)\n\t\t\t$scope.accountBalanceChange = parseFloat($scope.accountBalanceChange * -1); //If charge, change to neg since we are lowering account balance\n\t\telse if($scope.paymentType==paymentType.aptAdjustment)\n\t\t\t$scope.accountBalanceChange += parseFloat($scope.amountUnapplied); //If adjustment, use the amount unapplied to determine the balance change\n\t};\n}]);"]}