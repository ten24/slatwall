{"version":3,"sources":["directives/workflow/swworkflowtriggers.ts"],"names":[],"mappings":"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","file":"directives/workflow/swworkflowtriggers.js","sourceRoot":"/Users/david/Sites/Slatwall/","sourcesContent":["angular.module('slatwalladmin')\n.directive('swWorkflowTriggers', [\n'$log',\n'$location',\n'$slatwall',\n'workflowPartialsPath',\n'formService',\n\tfunction(\n\t$log,\n\t$location,\n\t$slatwall,\n\tworkflowPartialsPath,\n\tformService\n\t){\n\t\treturn {\n\t\t\trestrict: 'E',\n\t\t\tscope:{\n\t\t\t\tworkflow:\"=\"\n\t\t\t},\n\t\t\ttemplateUrl:workflowPartialsPath+\"workflowtriggers.html\",\n\t\t\tlink: function(scope, element,attrs,formController){\n\t\t\t\t$log.debug('Workflow triggers init');\t\n\t\t\t\tscope.$id = 'swWorkflowTriggers';\n\t\t\t\t/**\n\t\t\t\t * Retrieves the workflow triggers.\n\t\t\t\t */\t\n\t\t\t\tscope.getWorkflowTriggers = function(){\n\n\t\t\t\t\t/***\n\t\t\t\t\t   Note:\n\t\t\t\t\t   This conditional is checking whether or not we need to be retrieving to\n\t\t\t\t\t   items all over again. If we already have them, we won't make another\n\t\t\t\t\t   trip to the database. \n\t\t\t\t\t   \n\t\t\t\t\t***/\n\t\t\t\t\tif(angular.isUndefined(scope.workflow.data.workflowTriggers)){\n\t\t\t\t\t\tvar workflowTriggersPromise = scope.workflow.$$getWorkflowTriggers();\n\t\t\t\t\t\tworkflowTriggersPromise.then(function(){\n\t\t\t\t\t\t\t\t\tscope.workflowTriggers = scope.workflow.data.workflowTriggers;\n\t\t\t\t\t\t\t\t\t$log.debug('workflowtriggers');\n\t\t\t\t\t\t\t\t\t$log.debug(scope.workflowTriggers);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t/* resets the workflow trigger */\n\t\t\t\t\t\t\t\t\tif(angular.isUndefined(scope.workflow.data.workflowTriggers)){\n\t\t\t\t\t\t\t\t\t\tscope.workflow.data.workflowTriggers = [];\n\t\t\t\t\t\t\t\t\t\tscope.workflowTriggers = scope.workflow.data.workflowTriggers;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tangular.forEach(scope.workflowTriggers, function(workflowTrigger,key){\n\t\t\t\t\t\t\t\t\t$log.debug('trigger');\n\t\t\t\t\t\t\t\t\t$log.debug(workflowTrigger);\n\t\t\t\t\t\t\t\t\tif(workflowTrigger.data.triggerType === 'Schedule'){\n\t\t\t\t\t\t\t\t\t\tworkflowTrigger.$$getSchedule();\n\t\t\t\t\t\t\t\t\t\tworkflowTrigger.$$getScheduleCollection();\n\t\t\t\t\t\t\t\t\t}//<---end if\n\t\t\t\t\t\t\t\t});//<---end forEach\n\t\t\t\t\t\t\t});//<---end workflow triggers promise\n\t\t\t\t\t}else{\n\t\t\t\t\t\t//Use the cached versions.\n\t\t\t\t\t\tscope.workflowTriggers = scope.workflow.data.workflowTriggers;\n\t\t\t\t\t}//<---end else\n\t\t\t\t};\n\t\t\t\tscope.getWorkflowTriggers();//call triggers\n\t\t\t\t\n\t\t\t\tscope.showCollections = false;\n\t\t\t\tscope.collections = [];\n\t\t\t\tscope.getCollectionByWorkflowObject = function(){\n\t\t\t\t\tvar filterGroupsConfig ='['+  \n\t\t\t\t\t\t'{'+\n\t\t                 \t'\"filterGroup\":['+  \n\t\t\t\t\t            '{'+\n\t\t\t\t\t               '\"propertyIdentifier\":\"_collection.collectionObject\",'+\n\t\t\t\t\t               '\"comparisonOperator\":\"=\",'+\n\t\t\t\t\t               '\"value\":\"'+ scope.workflow.data.workflowObject +'\"'+\n\t\t\t\t\t           '}'+ \n\t\t\t\t\t         ']'+\n\t\t\t\t\t\t'}'+\n\t\t\t\t\t']';\n\t\t\t\t\tvar collectionsPromise = $slatwall.getEntity('Collection',{filterGroupsConfig:filterGroupsConfig});\n\t\t\t\t\t\n\t\t\t\t\tcollectionsPromise.then(function(value){\n\t\t\t\t\t\t$log.debug('getcollections');\n\t\t\t\t\t\tscope.collections = value.pageRecords;\n\t\t\t\t\t\t$log.debug(scope.collections);\n\t\t\t\t\t\t\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t\tscope.searchEvent = {\n\t\t\t\t\tname:''\t\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Watches for changes in the event\n\t\t\t\t */\n\t\t\t\tscope.showEventOptions = false;\n\t\t\t\tscope.eventOptions = [];\n\t\t\t\tscope.$watch('searchEvent.name', function(newValue, oldValue){\n\t\t\t\t\tif(newValue !== oldValue){\n\t\t\t\t\t\tscope.getEventOptions(scope.workflow.data.workflowObject);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t/**\n\t\t\t\t * Retrieves the event options for a workflow trigger item.\n\t\t\t\t */\n\t\t\t\tscope.getEventOptions = function(objectName){\n\t\t\t\t\tif(!scope.eventOptions.length){\n\t\t\t\t\t\tvar eventOptionsPromise = $slatwall.getEventOptions(objectName);\n\t\t\t\t\t\t\n\t\t\t\t\t\teventOptionsPromise.then(function(value){\n\t\t\t\t\t\t\t$log.debug('getEventOptions');\n\t\t\t\t\t\t\tscope.eventOptions = value.data;\n\t\t\t\t\t\t\t$log.debug(scope.eventOptions.name);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tscope.showEventOptions = !scope.showEventOptions;\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Saves the workflow triggers.\n\t\t\t\t */\n\t\t\t\tscope.saveWorkflowTrigger = function(context){\n\t\t\t\t\tvar saveWorkflowTriggerPromise = scope.workflowTriggers.selectedTrigger.$$save();\n\t\t\t\t\tsaveWorkflowTriggerPromise.then(function(){\n                        //Clear the form by adding a new task action if 'save and add another' otherwise, set save and set finished\n                        if (context == 'add'){\n                    \t\t\t$log.debug(\"Save and New\");\n                    \t\t\tscope.addWorkflowTrigger();\n                    \t\t\tscope.finished = false;\n                        }else if (context == \"finish\"){\n                        \t\tscope.finished = true;\n                        }\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Changes the selected trigger value.\n\t\t\t\t */\n\t\t\t\tscope.selectEvent = function(eventOption){\n\t\t\t\t\t$log.debug(\"SelectEvent\");\n\t\t\t\t\t$log.debug(eventOption);\n\t\t\t\t\t//Needs to clear old and set new.\n\t\t\t\t\tscope.workflowTriggers.selectedTrigger.data.triggerEvent = eventOption.value;\n\t\t\t\t\tif(eventOption.entityName == scope.workflow.data.workflowObject){\n\t\t\t\t\t\tscope.workflowTriggers.selectedTrigger.data.objectPropertyIdentifier = '';\n\t\t\t\t\t}else{\n\t\t\t\t\t\tscope.workflowTriggers.selectedTrigger.data.objectPropertyIdentifier = eventOption.entityName;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tscope.searchEvent.name = eventOption.name;\n\t\t\t\t\t$log.debug(eventOption);\n\t\t\t\t\t$log.debug(scope.workflowTriggers);\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Selects a new collection.\n\t\t\t\t */\n\t\t\t\tscope.selectCollection = function(collection){\n\t\t\t\t\t$log.debug('selectCollection');\n\t\t\t\t\tscope.workflowTriggers.selectedTrigger.data.scheduleCollection = collection;\n\t\t\t\t\tscope.showCollections = false;\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Removes a workflow trigger\n\t\t\t\t */\n\t\t\t\tscope.removeWorkflowTrigger = function(workflowTrigger){\n\t\t\t\t\tif(workflowTrigger === scope.workflowTriggers.selectedTrigger){\n\t\t\t\t\t\tdelete scope.workflowTriggers.selectedTrigger;\n\t\t\t\t\t}\n\t\t\t\t\tscope.workflowTriggers.splice(workflowTrigger.$$index,1);\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tscope.setAsEvent = function(workflowTrigger){\n\t\t\t\t\t//add event,  clear schedule\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tscope.setAsSchedule = function(workflowTrigger){\n\t\t\t\t\n\t\t\t\t};\n\t\t\t\t/**\n\t\t\t\t * Adds a workflow trigger.\n\t\t\t\t */\n\t\t\t\tscope.addWorkflowTrigger = function(){\n\t\t\t\t\t$log.debug('addWorkflowTrigger');\n\t\t\t\t\tvar newWorkflowTrigger = scope.workflow.$$addWorkflowTrigger();\n\t\t\t\t\tscope.workflowTriggers.selectedTrigger = newWorkflowTrigger;\n\t\t\t\t\t$log.debug(scope.workflowTriggers);\n\t\t\t\t};\n\t\t\t}\n\t\t};\n\t}\n]);\n\t\n"]}